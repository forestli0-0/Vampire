# 开发日志 / Devlog

## 2025-12-14：从“弹幕生存”转向“房间肉鸽”

### 现状回顾（我们现在更像什么游戏）
- 项目起源于《吸血鬼幸存者》式的“刷怪 + 拾取经验升级”的生存循环，但当前核心体验已明显向《哈迪斯》式“房间流”靠拢：清房 → 选门 → 拿奖励 → 继续推进 → Boss。
- 深度的主来源已经不再是“装很多武器堆弹幕”，而是三条并行的构筑系统：
  1) **伤害系统（Warframe Damage 2.0）**：护盾/护甲/元素/异常/弱点表，带来中后期的配装深度。
  2) **局外装配（武器 Mod）**：每把武器独立 Mod 配装，避免全局生效导致“武器特色被抹平”。
  3) **局内机制（Augment）**：通过事件钩子接入的机制改造（弹道变化、闪避流、击杀/移动触发等）。

### 已落地的关键能力（可视为阶段性里程碑）
- **房间流结构**：`state.runMode='rooms'`，房间奖励由清房宝箱/选门驱动，默认弱化“经验=升级三选一”的刷屏节奏（`rooms.xpGivesUpgrades=false`）。
- **公平性与可读性**：敌方技能 telegraph 预警；精英可被打断；Boss 对硬控更抗/免疫（tenacity + hard CC immune）。
- **主动操作爽点**：闪避（充能/冷却/无敌帧）已经接入，并且围绕闪避已有一批“闪避流 Augment”。
- **视觉反馈**：AOE 预警改为径向填充；闪避加入残影（shader）与屏幕冲击波反馈。

### 当前问题（需要定规则，否则会继续“系统互相重叠”）
- **奖励与升级过量**：经验升级、精英宝箱、关卡结束宝箱都在给“强化”，会把决策稀释成“随便点都强”，节奏也会失真。
- **构筑层级边界不清**：局外 Mod、局内 Passive、局内 Augment 如果都在做同类加成，会导致玩法重复、武器身份感消失。
- **弹幕预算缺失**：分叉×碎裂×弹射×多重等组合如果缺少上限/递减，会让“弹幕天堂”自然变成最优解，压扁其他流派。

---

## 重新规划（先把“规矩”定死）

### 1) 节奏指标（每局应该给多少次“选择”）
先明确“每局期望几次三选一”，并把所有奖励都映射到这个指标上（升级/宝箱/房间奖励/精英奖励不再互相叠加失控）。

### 2) 三层构筑边界（谁负责什么）
- **局外**：职业/角色选择 + 起手武器 + 武器 Mod 配装（决定“基础手感与定位”）。
- **局内**：武器/被动/augment 的抉择（决定“本局路线与流派”）。
- **禁止重叠**：同一类增幅尽量只存在于一层（例如：不要同时在 Mod、被动、Augment 都提供“多重射击”这一类核心发牌）。

### 3) 弹幕预算（把“弹幕天堂”控制在目标占比）
维持“自动射击 + 局内 roguelike + 局外培养”，但把“堆弹幕”定位为少数构筑分支，而不是默认答案：
- 给弹道类 Augment/词条组合设置上限、递减或触发频率门槛。
- 默认武器槽/机制都围绕“3 把武器也能打出差异”来设计。

---

## Roadmap（建议按优先级推进）

### A. 职业系统 MVP（先做 3 个职业）
目标：让“人”有身份感，不再靠“堆武器”定义玩法。
- 每个职业至少包含：开局被动 + 初始倾向（例如更偏护盾/暴击/异常）+ 一小组“专属 Augment 偏好/权重”。

### B. 房间奖励经济重标定（把升级节奏变可控）
目标：让每一局的“选择次数”稳定、可预期、可调参。
- 清房奖励、精英奖励、Boss 奖励各自职责明确，避免同一房间连续弹出多次升级界面。
- 把“经验”更多变成战斗内的增长（等级/小成长），而不是无限触发三选一的按钮。

### C. 武器系统落地到“可替换 + 有特色”
目标：局内换武器形成路线转向；局外配装不被浪费。
- 局内出现新武器时，允许替换（而不是无限叠加），并且替换时继承该武器在局外的 Mod 配装。
- 每把武器明确定位/标签（射程、攻速、状态、控制、爆发、清杂、对精英等），让不同职业/augment 有明确偏好。

### D. 内容扩展（在规则稳定后再堆内容）
目标：在不破坏节奏的前提下增加可玩性与复刷动力。
- 房间类型：商店/事件/治疗/挑战房。
- 敌人技能包：更多 telegraph 技能与反制窗口。
- 信息呈现：状态图标、Boss 韧性/抗性提示等（避免“看不懂就强”）。

---

## 待拍板（需要明确的 3 个参数）
1) **每局总共出现几次“三选一”**：例如 10 / 12 / 15（房间奖励、宝箱、精英奖励都算在内）。
2) **职业差异强度**：强（玩法都不一样）/ 轻（起手偏好 + 小被动 + 权重倾向）。
3) **武器替换节奏**：每 2 房保底一次？还是只在特定房间（商店/宝箱房）出现？

> 以上三项一旦确定，后续所有系统（奖励、掉落、门、商店、武器池、Augment 权重）都围绕它收敛，避免“越做越散”。

---

## 2025-12-14：确立“单武器 + 船员小队”变种方向

### 核心动机（为什么不是照抄哈迪斯）
- 哈迪斯的核心爽点来自高质量动作系统与手感（普攻/特殊/求援/投弹/近战连段），而我们当前更强的是“伤害系统深度 + 构筑层机制 + telegraph 读条反制”。
- 因此把“房间流”当作**节奏框架**，把“核心玩法”定在 **Warframe式配装深度 + 小队协同**，可以绕开对美术/动作资产的硬要求。

### 已拍板设定（你刚确认的三点）
- 船员上限：**2 名**（组成 3 人小队：玩家 + 2 船员）。
- 船员有 **HP/倒地/救援**（需要玩家救起，提供新的风险与决策）。
- 招募来源：**商店/事件**（不是升级池里的“又一个强化”，避免系统重叠）。

### MVP 落地（当前代码已接上）
- 船员系统脚手架：`crew.lua`
  - 跟随/驻守切换：`1/2` 键（暂定）。
  - 倒地后在附近 **按住 E 复活**（带短暂无敌帧）。
  - 受击来源已覆盖：敌方子弹、接触伤害、冲锋/砸地等技能伤害。
- 房间流新增类型：`shop` / `event`
  - 进入后生成 `crew_contract`（招募点），交互后继续选门。

### 下一步（把它真正变成“我们的核心玩法”）
- **武器槽重构**：玩家固定 1 把武器；多出来的武器进入“队伍武器池”，可分配给船员（并且支持替换/继承 Mod 配装）。
- **商店/事件做成系统**：引入跑内货币与明确的“购买/招募/换装”交互，而不是纯免费点一下。
- **协同玩法落地**：围绕 Damage 2.0 做“破盾/剥甲/触发异常/集火标记”等队伍 combo，让小队协作成为主爽点。
- **大地图/章节化**（后置）：在玩法跑通后再把每章 3 张大图 + 1 boss 房、以及“船员自由探索/跟随”的复杂度加上去。
