# 宠物系统路线图（Pet System Roadmap）

> 目标：让本项目从“纯弹幕天堂”拉回到更像《黑帝斯》的**房间流 Roguelike**节奏，但又不依赖高成本动作/美术。  
> 宠物承担“功能型/低频触发”的第二轴：提供 utility、状态触发、节奏加速与新爽点，同时**避免把宠物做成第二把武器**（避免回到多武器平台）。

---

## 1) 定位（我们要做成什么样）

**宠物 = 低频触发的“工具/机制模块”**
- **不当输出主角**：尽量不做高频弹道/高密度投射物，避免性能与读屏崩坏。
- **更像 Warframe Companion/Precept**：做“规则改变/状态施加/护盾&护甲处理/救命按钮”，而不是“自动枪台”。
- **和玩家主武器互补**：玩家主武器决定主要输出形态；宠物决定“打谁、怎么打、用什么状态打开局面”。

**宠物路线的爽点**
- 你在局内会明显感受到：控场更稳、破盾/剥甲更顺、Dash 流更敢贴、房间节奏更快。
- 围绕宠物可以形成“功能流派”（破盾流/剥甲流/保命流/资源流），但总强度上不压过主武器 + Augment。
- 若我们把关卡模式升级为**大地图探索**：宠物还能承担“侦察/分头行动”的玩法，让强力玩家用宠物提速、弱势玩家把宠物留身边保命。

---

## 2) 现状盘点（已落地 MVP）

**系统形态**
- 单宠物槽：`state.pets.max = 1`（`pets.lua`）。
- 宠物有 HP/倒地/流血退场：倒地后按住 `E` 可复活，超时退场（`pets.lua` + `draw.lua` UI）。
- 宠物模式：`1` 键切换 `FOLLOW/HOLD`（`main.lua`）。
- 房间结算：清房时宠物 `runLevel +1`（`rooms.lua` 调用 `pets.bumpRunLevel`）。
- 特殊房：`shop` 可换宠/给宠物回血/买玩家医疗包；`event` 可复活退场宠物（`rooms.lua` + `pickups.lua`）。

**内容**
- 目前 3 只宠物：`pet_magnet / pet_corrosive / pet_guardian`（`state.lua` 目录项 + `pets.lua` 技能逻辑）。
- 当前实现里存在“模块（局外选择）”：例如 `default/pulse`、`default/field`、`default/barrier`（`arsenal.lua`）。**计划调整为：模块改为“圣物式掉落/商店购买”的局内拾取物，且局内不可替换**（见 5.1）。
- 局外轻度养成：`profile.petRanks` 提供基础 HP 与 CD 优化（已在逻辑中生效，但暂无专门 UI/获取途径）。

---

## 3) 设计边界（避免走回弹幕天堂）

1. **宠物允许直接造成伤害，但保持“低频/低密度”**：伤害以“关键一击/小范围爆发/打断窗口”为主，避免持续喷射型弹幕。
2. **宠物技能不吃 multishot/弹道包**：宠物能力不走玩家武器的弹道体系，避免组合爆炸与性能压力。
3. **宠物触发频率低**：以 2.5–5.0s 一次为基准，少量随机抖动即可。
4. **宠物的 AoE/链路有硬上限**：例如最多影响 6–10 个目标/次（避免房间大怪潮时爆炸）。
5. **宠物路线是“第二轴”，但不抢主轴**：宠物输出可以成为构筑的一部分，但主输出仍由玩家武器 + Augment 决定。

---

## 4) 大地图探索下的宠物机制（你提出的“分头行动”核心）

> 目标：在不依赖顶级动作/美术的前提下，提供“决策 + 风险 + 提速”的爽点。

### 4.1 三种行为模式（指令简单，但决策有分量）
1) **FOLLOW（跟随）**
- 宠物贴身作战/支援，最大化“稳定性与战力”。
- 适合：玩家前期、Build 未成型、需要容错与控场的时候。

2) **HOLD（驻守）**
- 宠物停在原地（或指定点），用于“守关键点/卡边/拉扯路线”。
- 适合：玩家需要风筝、想把怪潮引到宠物领域技能里，或守住已发现的掉落/事件点。

3) **SCOUT（探索/侦察）**
- 宠物主动前往地图边缘/未知区域，**发现 POI**（宝箱/精英/事件/商店/祭坛/出口）并“标记”给玩家。
- 如果你足够强：宠物探索 = 你提速；如果你不够强：探索会提高风险，你会倾向把宠物留身边。

### 4.2 SCOUT 的关键约束（前中期：避免过早变成“自动刷图”）
- **探索优先，战斗克制**：宠物在远离玩家时更偏“打一下就退/只处理小股敌人/以控场与状态为主”，避免离屏清屏影响主玩法。
- **风险明确**：探索中宠物仍可能倒地/退场，玩家需要做“救不救/绕不绕路/要不要召回”的抉择。
- **回报可控**：前中期宠物更适合“发现/标记/带回少量资源”，避免把大宝箱直接吞掉导致节奏失衡。

### 4.3 可视化与操控（否则离屏行为会变得不可信）
- UI 至少需要：宠物方向指示/距离、宠物当前模式、宠物发现 POI 的提示（小文本 + 地图标记/箭头）。
- 指令交互建议：一个键循环（FOLLOW/HOLD/SCOUT）+ 一个召回键（带短 CD）。

### 4.4 后期演化：让“宠物刷图”成为一种玩法奖励（创新点）
> 你说的“后期宠物自动刷图也很乐趣”可以做成**成长目标**：把自动化当成玩家变强后的提速方式，而不是开局就喧宾夺主。

- **分阶段解锁（建议）**
  - `SCOUT`：发现/标记为主（前期）。
  - `SKIRMISH`：会主动清理小股敌人（中期），但有上限（命中数/目标数/时间）。
  - `AUTO-CLEAR`：能完成“边缘 POI”或小型据点的清理（后期），并把收益带回或标记给玩家。
  - `AUTO-FARM`：循环刷边界/巡逻路线（终局），用于提速与刷资源。
- **保持可玩性（关键约束）**
  - 自动化有成本：召回 CD、行动能量/指令点、携带容量。
  - 自动化有风险：倒地/退场依然存在，逼迫玩家做“要不要救”的决策。
  - 自动化有权衡：离屏收益可做“折算/损耗”（例如只带回部分金币/材料），让主动探索仍然有价值。

> 结论：这条路线能把宠物从“随从”升级为“第二条进度线”，并且天然提供创新的“分头行动提速”玩法。

---

## 5) 成长设计（局内为主 + 局外为辅）

### 5.1 局内（临时成长为主）
**主线：runLevel（已有）**
- 清房 `runLevel + 1`：继续作为“宠物节奏/强度曲线”的主索引（CD、范围、层数、伤害系数）。

**宠物局内升级（新增方向：宠物专属升级池）**
- 目标：让玩家能做“宠物输出/宠物增益/宠物控制”的路线，而不是只有换宠与复活。
- 频率建议（避免奖励溢出）：
  - **不增加总升级次数**：宠物升级通过 `shop`/掉落触发，或替换掉少量普通升级。
  - 或者设定“每章 1 次宠物升级机会”，由玩家主动选择是否拿（否则跳过）。
- 升级类型建议（先做 8–12 个通用条目）：
  - 输出：宠物技能伤害系数、额外一次命中（有上限）、对精英/护盾加成。
  - 增益：Guardian 的治疗/屏障更强；给玩家短暂增伤/减伤窗口。
  - 控制：更高的异常叠层、短暂硬控（非 boss）、更可靠的打断精英读条。
  - 生存：宠物最大 HP/护甲、倒地后复活更快/流血时间更长（小幅）。

**“圣物式掉落”：宠物模块（Pet Relics / Chips）**
- 把“宠物模块”改成类似《暖雪》圣物的**局内拾取物**：掉落/宝箱/商店可获得。
- 规则（与你的选择一致）：**局内不可替换**（拿了就是本局绑定），避免频繁切换导致信息负担。
- 建议结构：
  - 每局最多携带 `N` 个（例如 3 个），超过则不再掉落或只能跳过。
  - 模块分稀有度/标签（输出/控制/资源/保命），并可和宠物种类有轻度联动。

### 5.2 局外（配置与基础属性）
**宠物模块局外不可配置（改动）**
- 既然模块主要通过“局内掉落/商店”获取，则局外只保留“起始宠物选择”与轻度 Rank。

**Pet Rank（轻度永久养成）**
- 目标：让“选宠物”具备长期动机，但不要变成数值碾压。
- 建议 Rank 只影响：
  - 基础 HP（耐久）
  - 技能 CD（节奏）
  - 倒地复活体验（例如略缩短 `reviveHoldTime`、略延长 `bleedoutTime`）
- Rank 获取建议：局外 `Credits` 消费 + 少量解锁条件（Boss 首杀/事件解锁），避免刷 grind。

（旧）Pet Module（局外开关）将被“圣物式宠物模块”取代。

---

## 6) 内容扩展计划（先把“路线感”做出来）

### 6.1 下一批宠物（建议再加 3 只，凑到 6 只）
> 目标：每只宠物都能对应一个“问题解法”，而不是换皮。

1. **Viral Bat（病毒蝠）**：提供 `VIRAL`，让“打血”流派更顺（适合高攻速/多段武器）。
2. **Heat Imp（热焰灵）**：提供 `HEAT`（点燃/软剥甲/打断低阶技能），适合清杂与压制。
3. **Frost Sprite（霜精）**：提供 `COLD`（减速/提高暴击收益/控制读条），适合偏走位与风筝。

### 6.2 每只宠物至少 3 个模块（长期目标）
模块设计遵循“同一宠物 = 同一主题，不同模块 = 不同打法”：
- **单点标记**（更像点杀/破防）
- **近身光环/领域**（更像控场/站位）
- **支援/保命**（更像节奏/容错）

---

## 7) 事件与商店（宠物成为“跑内决策”）

**Shop（已有）**
- 换宠（Pet Contract）
- 宠物回血（Pet Treat）
- 玩家医疗包（Medkit）

**建议新增（优先级由高到低）**
1. **Pet Module（购买模块）**：直接卖 1 个宠物模块（圣物），作为经济消费点与路线入口。
2. **Pet Upgrade Chip**：触发一次“宠物专属三选一”（把宠物升级和经济挂钩）。
3. **Revive Beacon**：如果宠物已退场，直接复活（昂贵，救急）。
4. **Pet Armor Plate**：本局宠物获得少量护甲/减伤（不影响输出，提升路线稳定性）。

**Event（已有：宠物退场必出复活事件）**
- 继续扩充“事件模板”，让它像 Hades 那样有风险/收益/叙事味：
  - 以玩家 HP/金币/下一房间难度为代价，换宠物强化/复活/模块重置。

---

## 8) 工程改造建议（为“好扩展”铺路）

当前痛点：宠物模块与技能逻辑有一部分硬编码在 `pets.lua` / `arsenal.lua`。

**建议的下一步重构（小而美）**
- 把每只宠物的 `modules` 列表与“模块说明/参数”移动到 `state.catalog[petKey]` 中。
- 把 `doPetAbility` 做成数据驱动：`petDef.onAbility(state, pet, ctx)` 或 `petDef.modules[module].onAbility(...)`。
- Arsenal 读取 catalog 自动展示模块，避免每加一只宠物都要改 UI 代码。

这一步做完后，“加新宠物/新模块”基本只需要改 `state.lua`（catalog）+ 少量 VFX。

---

## 9) 已拍板的关键决策（当前版本）

1. 宠物允许直接造成伤害（但坚持低频/低密度、避免弹幕化）。
2. 宠物模块局内不可替换（模块以“圣物式掉落/商店购买”为主要来源）。
3. 宠物局内可升级（输出/增益强度等）。
4. 宠物退场惩罚保持现状（倒地 → 可救，超时退场 → 事件复活）。
