# Damage 2.0 重构路线图

## 目标
- 用 `calculator.lua` 统一伤害与状态结算，逐步引入 Warframe 风格的护盾/护甲/元素克制与异常。
- 保持游戏循环和已有体验稳定，阶段式迭代，每一步可运行可验证。

## 状态
- **核心目标已完成**（阶段 1–3 ✅）
- 阶段 4–5 为后续可选优化/扩展（不影响当前爽玩与系统正确性）

## 阶段拆分
1) **基础集中化（已完成）**
   - 建立 `calculator.lua`，收拢暴击/状态判定与伤害结算。
   - `projectiles.lua` / `weapons.lua` 命中统一走 `applyHit`。
   - 敌人接入 `health/shield/armor` 字段，默认值 0 不改平衡。

2) **防御层与可视化（已完成）**
   - 护盾再生：受击后延迟 2.5s，每秒回复 25% 最大护盾。
   - 护甲减伤：`DR = armor / (armor + 300)`（封顶 90%）。
   - UI：红/蓝/黄条；护盾伤害飘字蓝色；模板提示敌人可定义 `shield/armor`。
   - 新敌人示例：`shield_lancer`（小护盾+护甲），`armored_brute`（高血高护甲）。

3) **元素与异常（已完成）**
   - DamageInstance 支持按类型拆分伤害（`damageBreakdown`/`damageByType`），基础元素自动合成复合元素；直击按段结算。
   - 状态触发按各类型权重抽取；每个 proc 继承对应元素的 baseDamage。
   - 引入 Warframe Damage 2.0 护盾/生命/护甲弱点表，敌人可配置 `healthType/shieldType/armorType`；DoT 每跳同样套用类型修正。
   - 规则对齐：毒素跳过护盾、磁力锁盾+护盾增伤、腐蚀剥甲、病毒增伤生命、火临时减甲+DoT、电连锁眩晕、冰冻结/慢速、爆炸/穿刺/重击/辐射等状态已接入。

4) **数值与平衡回合（后续/可选）**
   - 为武器定义元素组合与状态概率，逐一迁移命中逻辑到元素化路径。
   - 运行 `benchmark.lua` 和一局实机，校验 FPS 和 TTK；调整敌人护盾/护甲默认值与武器伤害。
   - 设计磁力/腐蚀/病毒的飘字或图标提示，避免信息过载。

5) **后续扩展（可选）**
   - 更细致的敌人护盾类型/再生速率差异；精英/Boss 专属抗性。
   - 元素组合 UI 提示，武器/被动面板显示元素与触发几率。
   - 进一步的数据驱动（表驱动武器/敌人/状态）。

## 验证建议
- 每阶段后跑 `benchmark.lua`，记录 FPS 变化。
- 快速局内验证：携带火+油/冰+毒/电系武器观察护盾、护甲反馈与飘字颜色。
- 若发现护盾刷新/磁力禁盾异常，优先检查 `enemies.damageEnemy` 和 `enemies.update` 的状态字段与再生逻辑。
