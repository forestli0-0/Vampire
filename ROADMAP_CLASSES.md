# 职业系统路线图（Class System Roadmap）

> 核心问题：如果全自动，职业只是"数值模板+权重池"，没有手感区分。
> 
> 解决方案：**取消自动射击 + 每个职业有 1 个主动技能**，通过操作区分"我在玩什么角色"。

---

## 1) 操作键设计（核心变更）

### 1.1 设计原则

**从"自动弹幕"转向"手动操作"**：
- 攻击需要主动按键（按住连续攻击）
- "自动扳机"作为**局外道具**，解锁后恢复自动射击（给轻度玩家选择）
- 职业技能与攻击分离，需要主动释放

### 1.2 新操作方案

| 按键 | 功能 | 说明 |
|------|------|------|
| **WASD** | 移动 | 核心操作 |
| **鼠标左键 / J** | 攻击 | 按住连续攻击，向鼠标方向/面朝方向 |
| **Space** | 闪避 | 已有完整实现 |
| **Q** | 职业技能 | 每职业不同，有 CD |
| **P** | 宠物模式切换 | FOLLOW/HOLD（原 1 键） |
| **E** | 交互/复活宠物 | 情境触发 |

> **为什么用 J 键备选**：部分玩家习惯纯键盘操作，J 是常见的攻击键位。

### 1.3 攻击机制详解

```
默认行为（无"自动扳机"）：
- 按住攻击键 → 武器按 CD 自动发射
- 松开攻击键 → 停止发射
- 武器 CD 正常计算，不因按住就加速

局外道具"自动扳机"效果：
- 解锁后：无需按住，武器自动发射（恢复当前行为）
- 定位：便利道具，适合不想频繁操作的玩家
```

### 1.4 瞄准方式（混合模式）

**设计原则**：默认自动索敌，Shift 切换精确瞄准。

| 武器类型 | 默认瞄准 | Shift 精确瞄准 |
|----------|----------|----------------|
| **远程** | 自动索敌（最近敌人方向） | 向鼠标方向 |
| **近战** | 移动方向 / 面朝方向 | 向鼠标方向 |

```
远程武器默认行为：
- 自动寻找最近敌人
- 向该敌人方向发射
- 无敌人时向面朝方向

近战武器默认行为：
- 移动时：向移动方向攻击
- 站立时：向上次移动方向 / 面朝方向攻击

Shift 精确模式（所有武器）：
- 按住 Shift：向鼠标光标方向攻击
- 可以"背身攻击"或精确打优先目标
```

---

## 2) 按键总览（完整版）

| 按键 | 游戏中 | 升级界面 | 商店界面 |
|------|--------|----------|----------|
| **WASD** | 移动 | — | — |
| **鼠标左/J** | 攻击 | — | — |
| **Space** | 闪避 | — | — |
| **Q** | 职业技能 | — | — |
| **P** | 宠物模式 | — | — |
| **E** | 交互/复活 | — | — |
| **1-3** | — | 选择升级 | 购买商品 |
| **0/Esc** | — | — | 离开商店 |
| **F3** | 调试菜单 | 调试菜单 | — |

---

## 3) 职业设计（先做 3 个 MVP）

### 2.1 设计原则

1. **一职业一技能**：每个职业的 Q 技能是独特的，不共享。
2. **开局差异明显**：起手武器、被动、Augment 权重都不同。
3. **路线偏好不同**：近战/远程/控制分流，但不硬锁（可通过商店/事件转型）。

### 2.2 三职业概念

---

#### 🗡️ **战士（Warrior / Vanguard）**

**定位**：近战、高护甲、闪避流

| 属性 | 数值 | 说明 |
|------|------|------|
| 基础 HP | 150 | 高 |
| 基础护甲 | 15 | 有减伤 |
| 移速 | 标准 | — |
| 闪避充能 | 2 | 比默认多 |

**Q 技能：战吼 / War Cry**
- 效果：短距离前冲，命中敌人造成 AOE 伤害，附带短暂击退/眩晕
- CD：4 秒
- 与闪避联动：可用于进场/退场，比闪避更有攻击性

**开局配置**
- 起手武器：斧头（Axe）或战锤（Heavy Hammer）
- Augment 权重：闪避流（`aug_dash_strike`, `aug_longstride`）权重 +50%
- 宠物偏好：Guardian（屏障/保命）

---

#### 🔮 **法师（Mage / Arcanist）**

**定位**：远程、低 HP、弹道变化流

| 属性 | 数值 | 说明 |
|------|------|------|
| 基础 HP | 80 | 低 |
| 基础护甲 | 0 | 无减伤 |
| 移速 | 标准 | — |
| 暴击率 | +10% | 天生更容易暴击 |

**Q 技能：元素爆发 / Elemental Burst**
- 效果：立即向鼠标方向发射一发高伤害弹道（吃当前武器元素），可暴击
- CD：3 秒
- 与弹道包联动：若有分叉/弹射 Augment，此技能也会生效

**开局配置**
- 起手武器：魔杖（Wand）
- Augment 权重：弹道类（`aug_forked_trajectory`, `aug_ricochet_matrix`）权重 +50%
- 宠物偏好：Corrosive（剥甲/破防）

---

#### 🐾 **驯兽师（Beastmaster / Handler）**

**定位**：宠物加强、控制、异常触发

| 属性 | 数值 | 说明 |
|------|------|------|
| 基础 HP | 100 | 中 |
| 基础护甲 | 5 | 略有减伤 |
| 状态触发率 | +15% | 更容易触发异常 |
| 宠物 HP | +25% | 宠物更耐打 |

**Q 技能：猎犬突袭 / Sic 'Em**
- 效果：命令宠物立即冲向最近敌人，造成伤害并施加当前宠物的状态效果
- CD：5 秒
- 宠物驻守时：改为"召回宠物到身边+短暂护盾"

**开局配置**
- 起手武器：飞刀（Throwing Knife）或冰环（Ice Ring）
- Augment 权重：状态类（`aug_blood_burst`, `aug_combo_arc`）权重 +50%
- 宠物偏好：任意（此职业专精宠物）

---

## 4) 经济与开局保底的联动

### 3.1 职业影响开局保底

根据 `ECONOMY_PACING.md` 的设定（前 5 分钟给 30%+ 资源），不同职业的开局保底内容应不同：

| 职业 | 第 1 次保底（升级） | 第 2 次保底（Augment） |
|------|---------------------|------------------------|
| 战士 | 近战武器/闪避被动 | 闪避流 Augment |
| 法师 | 投射物武器/暴击被动 | 弹道变化 Augment |
| 驯兽师 | 状态武器/触发被动 | 宠物增强 Augment |

### 3.2 权重池实现思路

```lua
-- state.catalog 中每个 weapon/augment 可增加 classWeight 字段
catalog.axe = {
    type = 'weapon',
    classWeight = { warrior = 2.0, mage = 0.5, beastmaster = 1.0 },
    -- ...
}

-- upgrades.generateUpgradeOptions 中按当前职业调整权重
local weight = (item.classWeight and item.classWeight[state.player.class]) or 1.0
```

---

## 5) 实现计划（分阶段）

### Phase 0：攻击系统改造（前置，3-5 天）

- [ ] `weapons.lua`：新增 `state.player.isFiring` 状态，只有为 true 时武器才发射
- [ ] `main.lua`：监听鼠标左键/J 键，更新 `isFiring` 状态
- [ ] `player.lua`：新增 `player.getAimDirection(state)` 返回瞄准方向（鼠标/移动方向）
- [ ] `weapons.lua`：投射物发射方向改为 `getAimDirection()` 返回值
- [ ] `state.lua`：新增局外道具 `autoTrigger`（自动扳机），持有时跳过 `isFiring` 检查
- [ ] `draw.lua`：十字准星绘制（鼠标瞄准时）

### Phase 1：职业骨架（1 周）

- [ ] `state.lua`：新增 `player.class` 字段和职业定义表
- [ ] `player.lua`：新增 `player.useAbility(state)` 和 Q 键绑定
- [ ] `draw.lua`：技能 CD 指示器（简单圆环）
- [ ] `arsenal.lua`：开局职业选择界面
- [ ] `main.lua`：宠物键位从 `1` 改到 `P`
- [ ] 先实现 1 个职业（战士）的 Q 技能

### Phase 2：完整三职业（1-2 周）

- [ ] 法师、驯兽师的 Q 技能实现
- [ ] 职业属性差异（HP、护甲、触发率）
- [ ] 职业权重池影响升级选项
- [ ] 开局保底逻辑

### Phase 3：进阶（后置）

- [ ] 职业解锁条件（首杀 Boss/事件触发）
- [ ] 职业天赋树（局外永久养成）
- [ ] 终极技能（R 键）

---

## 6) 开放问题（已解决/剩余）

| 问题 | 状态 |
|------|------|
| 是否需要瞄准 | ✅ 已决定：使用鼠标瞄准 |
| 自动射击如何处理 | ✅ 已决定：作为局外道具"自动扳机" |
| 宠物键位 | ✅ 已决定：P 键 |

剩余问题：
1. **技能 CD 可视化**：最简方案（数字）还是完整方案（图标+遮罩）？
2. **战士技能"战吼"是否需要瞄准**：建议不需要（向面朝方向冲刺）

---

## 7) 总结：为什么需要操作键

| 问题 | 纯自动 | 有操作键 |
|------|--------|----------|
| 职业区分 | 数值模板 | 手感不同 |
| 玩家参与感 | 看数字变大 | 主动决策时机 |
| 技能深度 | 无 | CD 管理/时机选择 |
| Build 表达 | 堆数值 | 技能+道具联动 |

> **结论**：职业系统需要至少 1 个主动技能键（建议 Q），否则职业只是换皮。
